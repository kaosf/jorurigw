
<% _path = '/_attachs/gwcircular/'%>
<%
  if @item.blank?
    mce_base_url = ''
  else
    mce_base_url = _path + sprintf("%06d", @item.title_id) + '/' + @item.name + "/" unless @item.name.blank?
  end
%>
<%= tool_tiny_mce(mce_base_url, {:leftbar_mode=>true}) %>

<%= gw_js_include_full %>

<%= %Q(<div class="notice">#{flash[:notice]}</div>) if flash[:notice] %>

<table class="show bbsText">
  <tr>
    <th>回覧件名<%= required('※') %> ( 記事件名は140文字以内で入力してください )</th>
  </tr>
  <tr>
    <td><%= f.text_area :title, :cols => '140', :rows=>"1", :style => 'width:100%; height:45px'%></td>
  </tr>
  <tr>
    <th>回覧記事</th>
  </tr>
  <tr>
    <td class="mceEditor"><%= f.text_area :body, :class => 'mceEditor', :style => 'width:100%' %></td>
  </tr>
</table>

<%=gwcircular_attachments_form(f, @item)%>

<%= hidden_field_tag("item[state]", @item.state, :id=>"item_state") %>

<table class="show">
  <tr>
    <th>回覧期限日時<%= required('※') %></th>
    <td>
      <%
        dd = Gw.date8_to_date(params[:expiry_date], :default=>'')
        # date_picker は、f.text_field をそのまま呼ぶため、nil 渡しで DB 値を読んでくれるが、
        # date_picker2 は、text_field_tag 利用のため、value はセット済で呼んでやる必要がある。
        # 現時点では必ずフォーマット済日付をわたすようにしている。
        d_load_org = params[:expiry_date].nil? ? nil : dd == '' ? nil : Gw.datetime_str(dd)
        d_load = Gw.datetime_str(d_load_org.nil? ? @item.expiry_date : d_load_org)
        concat "#{date_picker3 f, 'expiry_date', d_load, :errors=>@item.errors}"
      %>
    </td>
  </tr>
</table>

<table class="show">
  <tr><th>既読にする形式</th>
  <td><%= f.select :confirmation, @item.confirmation_name , :class => 'confirmation'%></td></tr>
</table>

<%=render(:partial => '/gwcircular/admin/commissions/form')%>

<%= hidden_field_tag(:cond, params[:cond]) unless params[:cond].blank? %>

<script type="text/javascript">
//<![CDATA[
  function chageDisp(obj,changeObjId) {
    var display = document.getElementById(changeObjId).style.display;
    if (display == '') {
      obj.innerHTML = '開く▼';
    } else if (display == 'none') {
      obj.innerHTML = '閉じる▲';
    }
    Element.toggle($(changeObjId));
  }
//]]>
</script>

