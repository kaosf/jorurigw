<%# app/views/gw/public/todos/index.html.erb %>
<%
#render :partial => '/gw/public/todos/header'
#render :partial => 'search'
concat render(:partial => '/gw/public/todos/header')
proc_is_not_finished = Proc.new{|item| item.is_finished != 1 }
path_index = Site.request_path
options = {
  'sort_link_options' => {
    'disable_cols' => [],
    'sort_keys' => @sort_keys,
    'path_index' => path_index,
    'other_query_string' => @qs
  },
  'link_to_edit' => proc_is_not_finished,
  'link_to_destroy' => 0,
  'field_td_criteria' => {
    'ed_at' => Proc.new{|item|
      ret = Gw.date_common(item.ed_at)
      item.nil? || item.ed_at.nil? ? ret : (Time.now > item.ed_at && nz(item.is_finished,0) != 1 ? %Q(<font color="red">#{ret}</font>) : ret)
  }}, :link_to => [{
    #:path => %q('/gw/todos/[[id]]/quote'),
    #:caption => ['引用作成'],
    #:action => :quote # => for icon
  #},{
    :path => %q('/gw/todos/[[id]]/finish'),
    :caption => ['完了する','未完了に戻す'],
    :proc => proc_is_not_finished,
    :action => [:finish, :unfinish] # => for icon
  }],
  #'columns'=>[ :is_finished, :ed_at, :prior_id, :title, :category_id, :updated_at ]
#  :image_action_button => 1
  :buttons_right => 1,
}
unless params[:detail].nil?
  options[:detail] = :body
  options[:detail_auto_link] = 1
end

header = <<-EOL
#{render :partial => '/gw/public/todos/piece_header'}
EOL
body = { :body => <<-EOL
#{show_notice}
#{render :partial => '/gw/public/todos/search'}
#{table_to_index2(@items, options)}
#{paginate @items}
EOL
}
concat hhbff_struct(:todo, :index, :header=>header, :body=>body)
%>
