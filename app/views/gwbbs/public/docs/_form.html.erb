<% _path = '/_common/modules/gwbbs/'%>
<%
  if @item.blank?
    mce_base_url = ''
  else
    mce_base_url = _path + sprintf("%06d", @item.title_id) + '/' + @item.name + "/" unless @item.name.blank?
  end
%>
<%= tool_tiny_mce(mce_base_url, {:leftbar_mode=>true}) %>

<%= gw_js_include_full %>

<%= %Q(<div class="notice">#{flash[:notice]}</div>) if flash[:notice] %>

<%unless @title.one_line_use == 0%>
<table class="bbsComment">
  <tr>
    <th>1行コメント</th>
    <td><%= f.select :one_line_note, @item.one_line_states , :class => 'select one_line_note'%></td>
  </tr>
</table>
<%end%>
<table class="show">
  <tr>
    <th>公開開始日時<%= required('※') %></th>
    <td>
      <%
        dd = Gw.date8_to_date(params[:able_date], :default=>'')
        # date_picker は、f.text_field をそのまま呼ぶため、nil 渡しで DB 値を読んでくれるが、
        # date_picker2 は、text_field_tag 利用のため、value はセット済で呼んでやる必要がある。
        # 現時点では必ずフォーマット済日付をわたすようにしている。
        d_load_org = params[:able_date].nil? ? nil : dd == '' ? nil : Gw.datetime_str(dd)
        d_load = Gw.datetime_str(d_load_org.nil? ? @item.able_date : d_load_org)
        concat "#{date_picker3 f, 'able_date', d_load, :errors=>@item.errors}"
      %>
    </td>
    <th>公開終了日時<%= required('※') %></th>
    <td>
      <%
        dd = Gw.date8_to_date(params[:expiry_date], :default=>'')
        # date_picker は、f.text_field をそのまま呼ぶため、nil 渡しで DB 値を読んでくれるが、
        # date_picker2 は、text_field_tag 利用のため、value はセット済で呼んでやる必要がある。
        # 現時点では必ずフォーマット済日付をわたすようにしている。
        d_load_org = params[:expiry_date].nil? ? nil : dd == '' ? nil : Gw.datetime_str(dd)
        d_load = Gw.datetime_str(d_load_org.nil? ? @item.expiry_date : d_load_org)
        concat "#{date_picker3 f, 'expiry_date', d_load, :errors=>@item.errors}"
      %>
    </td>
  </tr>
  <tr>
    <th>記事管理課<%= required('※') %></th>
    <td colspan="3">
      <%= f.select(:section_code, Gwboard::Group.level3_all.collect{|i|
      [i.name, i.code]}, :include_blank => '記事の管理課を選択してください') %>
    </td>
  </tr>

<%if @title.category == 1 %>
  <tr>
    <th>
      <%= @title.category1_name unless @title.category1_name.blank? %><%= required('※') %>
    </th>
    <td colspan="3">
      <%= f.select(:category1_id, @categories1.collect{|i|
      [i.name, i.id]}, :include_blank => '分類を選択してください') %>
    </td>
  </tr>
<%end%>
<%if @title.importance == 1 %>
  <tr>
    <th>ステータス</th>
    <td colspan="3"><%=radio f, :importance, @item.importance_states, :class => 'state' %>
    </td>
  </tr>
<%end%>
</table>


<script type="text/javascript">
//<![CDATA[
  function chageDisp(obj,changeObjId) {
    var display = document.getElementById(changeObjId).style.display;
    if (display == '') {
      obj.innerHTML = '開く▼';
    } else if (display == 'none') {
      obj.innerHTML = '閉じる▲';
    }
    Element.toggle($(changeObjId));
  }
//]]>
</script>

<script type="text/javascript">
//<![CDATA[
  var supressBeforeUnload = false;

  window.onbeforeunload = function( event ) {
    if (!supressBeforeUnload) {
      event = event || window.event;
      event.returnValue = "保存していない場合、編集中の内容は失われます";
      return "保存していない場合、編集中の内容は失われます";
    }
  }
//]]>
</script>
