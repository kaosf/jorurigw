<%

@hedder2lnk = 1
@hedder2lnk = 7 if params[:be] == "other"
@hedder2lnk = 7 if @gid.to_i != @prop_gid.to_i && params[:be].blank? && params[:s_genre] == "other" && !params[:prop_id].blank?

@hedder3lnk = 2
@view = "week"

d = @st_date

table_summary = '<table summary="スケジュール詳細" class="scheduleTable'
table_summary+= ' '+ @custom_group.name_en.gsub(" ", "_").camelize(:lower) if @custom_group && !@custom_group.name_en.blank?
table_summary+= '">'

header_str = ""
show_flg = true
case @sp_mode
when :schedule

when :prop
  props = Gw::Model::Schedule.get_props(params, @is_gw_admin, {:s_other_admin_gid=>@s_other_admin_gid})
  show_flg = false if props.length == 0
  if !params[:prop_id].blank?
    _mdl = Gw::Model::Schedule.get_prop_model(params)
    prop = _mdl.find_by_id(params[:prop_id])
    show_flg = prop.delete_state == 0 ? true : false
    if show_flg && @genre == 'other' && !@is_gw_admin
      if !Gw::PropOtherRole.is_edit?(params[:prop_id]) && !Gw::PropOtherRole.is_read?(params[:prop_id])
        show_flg = false
      end
    end
  end
end
header_str = header_str.gsub(/\r\n|\r|\n/, "")

body_str = if show_flg
  render :partial => '/gw/public/schedules/show_week_part', :locals=>{:d=>d, :mode=>'week'}
else
   Gw.div_notice('表示する項目はありません。')
end

header = <<-EOL
#{render :partial => '/gw/public/schedules/piece_header', :locals=>{:piece_head_title => @piece_head_title}}
EOL
body = {
  :header =>  <<-EOL,
#{header_str}
#{render(:partial => '/gw/public/schedules/schedule_header', :locals=>{:d=>d, :mode=>'week', :show_flg => show_flg})}
#{show_notice}
EOL
  :body => <<-EOL,
#{table_summary}
#{body_str}
</table>
EOL
  :footer => render(:partial => '/gw/public/schedules/schedule_footer', :locals=>{:d=>d, :mode=>'week', :show_flg => show_flg})
}


concat <<-EOL

#{hhbff_struct(:schedulePiece, :weekview, :header=>header, :body=>body)}
#{gw_js_ind_popup}
<script type="text/javascript">
//<![CDATA[
  var my_load = function() {
    gw_js_ind_popup();
  }
  window.onload = my_load;
//]]>
</script>
EOL
%>
